#meta
  %h1#title=h @topic.title

  - if logged_in?
    :javascript
      new Ajax.InPlaceEditor('title', '#{update_title_of_topic_path(@topic)}', { highlightendcolor: "#e5e5e5"});

  #taglist
    %h2 Tags
    %ul
      - @topic.tags.each do |tag|
        %li{ :id => "tag-#{tag.name.gsub(/\s/, "-")}" }
          = link_to_remote "[x]", :url => untag_topic_path(@topic, :tag => tag.name) if logged_in?
          = link_to h(tag.name), tag
    - if logged_in?
      - form_for(:tag, :url => tag_topic_path(@topic)) do |f|
        = f.text_field :name, :style => "width: 142px"
        = f.submit "add"

  #talking
    %h3
      Who's talking?
      %small (by time last seen)
    %ol
      - posters_by_latest(@topic.posts).each do |user, time|
        %li
          = time.to_formatted_s(:short)
          = link_to h(user.name), user

  - if admin?
    #admin
      %h2 Administrative
      %p Split topic with checked messages.

#posts
  - prevpost = nil
  - @topic.posts.each do |post|
    - user_continuation = (prevpost.user == post.user rescue false)
    %a{ :name => post.id }/
    .post
      - unless user_continuation
        .user{ :title => h(post.user.name) }
          = h(shorten_username(post.user.name))
          /- if post.body.length > 100
          /  %img{ :src => "http://www.gravatar.com/avatar/#{Digest::MD5.hexdigest(post.user.email.downcase)}?s=30" }

      .mark<
        = check_box :post, :check3
      .time<
        = link_to(post.created_at.to_formatted_s(:short), topic_post_path(@topic, post))
      .body<
        = user_html(post.body)
    - prevpost = post

  - if logged_in?
    = render :partial => 'posts/slowreply'
    = render :partial => 'posts/quickreply'
